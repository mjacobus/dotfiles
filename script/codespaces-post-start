#!/usr/bin/env bash

# https://github.com/github/ghcs

MAIN_PROJECT=`pwd`

function log() {
  echo "`date` - $1" >> ~/DOTFILES_LOG
}

function start_log() {
  log "Starting $1"
}

function finish_log() {
  log "Finishing $1"
}


start_log "Codespaces"

set -e

if [[ ! -d /workspaces/dotfiles ]]; then
  git clone git@github.com:mjacobus/dotfiles.git /workspaces/dotfiles
fi

start_log "symlinks"
ln -s /workspaces/dotfiles ~/.dotfiles
ln -s /workspaces ~/Projects
finish_log "symlinks"

cd $MAIN_PROJECT
bundle install

start_log "asdf"
./exe/dotfiles --only=asdf
finish_log "asdf"

start_log "git"
./exe/dotfiles --only=git --email=marcelo.jacobus@gmail.com
finish_log "git"

start_log "ag"
./exe/dotfiles --only=ag
finish_log "ag"

start_log "tmux"
sudo apt-get install -y tmux
./exe/dotfiles --only=tmux
finish_log "tmux"

start_log "ag"
./exe/dotfiles --only=vim
finish_log "ag"

start_log "irb"
./exe/dotfiles --only=irb
finish_log "irb"

start_log "inputrc"
./exe/dotfiles --only=inputrc
finish_log "inputrc"

start_log "zshell"
./exe/dotfiles --only=zshell
finish_log "zshell"

start_log "ctags"
./exe/dotfiles --only=ctags
finish_log "ctags"

# Install neovim
if [[ ! -d /workspaces/neovim ]]; then
  start_log "Neovim installation"
  sudo apt-get install ninja-build gettext libtool libtool-bin autoconf automake cmake g++ pkg-config unzip curl
  git clone https://github.com/neovim/neovim ~/Projects/neovim
  cd ~/Projects/neovim
  make -j4
  sudo make install
  finish_log "Neovim installation"
fi

# Neovim config
if [[ ! -d /workspaces/neovim ]]; then
  start_log "Neovim Config"
  git clone https://github.com/mjacobus/neovim-config ~/Projects/neovim-config
  cd ~/Projects/neovim-config
  ./install
  start_log "Neovim Config"
fi

finish_log "Codespaces"
