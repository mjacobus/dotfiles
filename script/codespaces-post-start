#!/usr/bin/env bash

# https://github.com/github/ghcs

set -e

MAIN_PROJECT=`pwd`

function log() {
  message="`date` - $1"
  echo $message
  echo $message >> ~/DOTFILES_LOG
}

function start_log() {
  log "Starting $1"
}

function finish_log() {
  log "Finishing $1"
}

start_log "Codespaces"


if [[ ! -d /workspaces/dotfiles ]]; then
  git clone git@github.com:mjacobus/dotfiles.git /workspaces/dotfiles
fi

start_log "symlinks"
mv  ~/.dotfiles ~/.dotfiles-bkp
[[ ! -d ~/.dotfiles ]] && ln -s /workspaces/dotfiles ~/.dotfiles
[[ ! -d ~/Projects ]] && ln -s /workspaces ~/Projects
finish_log "symlinks"

cd $MAIN_PROJECT
bundle install

start_log "zshell"
./exe/dotfiles --only=zshell
finish_log "zshell"

start_log "asdf"
./exe/dotfiles --only=asdf
finish_log "asdf"

start_log "git"
./exe/dotfiles --only=git --email=marcelo.jacobus@gmail.com
finish_log "git"

start_log "ag"
./exe/dotfiles --only=ag
finish_log "ag"

start_log "tmux"
sudo apt-get install -y tmux
./exe/dotfiles --only=tmux
finish_log "tmux"

start_log "irb"
./exe/dotfiles --only=irb
finish_log "irb"

start_log "inputrc"
./exe/dotfiles --only=inputrc
finish_log "inputrc"

start_log "ctags"
./exe/dotfiles --only=ctags
finish_log "ctags"

log "FINISHED! Now open tmux and run ./script/codespaces-post-start-manual"

